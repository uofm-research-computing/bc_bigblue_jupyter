# Job submission configuration file
#

<%-

  partition = global_queues == "any" ? "icomputeq,igpuq,ibigmemq,acomputeq,agpuq,abigmemq" : "#{global_queues}"
  slurm_args = [ "--nodes", "1", "--cpus-per-task", "#{num_cores}", "--mem", "#{alloc_mem}G", "--partition", partition ]
  if ngpus != "0"
    slurm_args.append( "--gres=gpu:#{ngpus}" )
  end
  if email != ""
    slurm_args.append( "--mail-user=#{email}" )
    slurm_args.append( "--mail-type=ALL" )
  end
  
%>
---
batch_connect:
  template: basic
  set_host: "host=$(hostname -A | awk '{print $1}')"
  script_file: "600"
script:
  native:
  <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
  <%- end %>
